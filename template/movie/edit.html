<!DOCTYPE html>
<html>

<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>[[${str}]] | 影片信息编辑</title>
<link th:href="@{{sp}/css/bootstrap.min.css(sp=${pub_bucket})}" rel="stylesheet">
<link th:href="@{{sp}/font-awesome/css/font-awesome.css(sp=${pub_bucket})}" rel="stylesheet">
<link th:href="@{{sp}/css/animate.css(sp=${pub_bucket})}" rel="stylesheet">
<link th:href="@{{sp}/css/style.css(sp=${pub_bucket})}" rel="stylesheet">
<link th:href="@{{sp}/jqui1114/jquery-ui.css(sp=${pub_bucket})}" rel="stylesheet">
<link th:href="@{{sp}/css/plugins/select2/select2.min.css(sp=${pub_bucket})}" rel="stylesheet">

<link th:href="|${pub_bucket}/css/plugins/summernote/summernote.css|" rel="stylesheet">
<link th:href="|${pub_bucket}/css/plugins/summernote/summernote-bs3.css|" rel="stylesheet">
</head>

<body>
	<div id="wrapper">
		<div th:replace="../common/nav"></div>
		<div id="page-wrapper" class="gray-bg">
			<div th:replace="../common/top"></div>   <!-- 顶部 -->
			<div class="row wrapper border-bottom white-bg page-heading">
				<div class="col-lg-10">
					<h2>[[${movie_info.film_name}]]</h2>
					<ol class="breadcrumb">
						<li><a href="javascript:;">[[${movie_info.film_no}]]</a></li>
					</ol>
				</div>
				<div class="col-lg-2">
					<div class="inline-group">
						<button class="btn btn-primary btn-sm save_content"><i class="fa fa-pencil"></i>保存</button>
					</div>
					
				</div>
			</div>

			<div class="wrapper wrapper-content animated fadeInRight">
				<div class="row">
					<div class="col-lg-5">
						<div class="ibox float-e-margins">
							<div class="ibox-title">
								<h5>基本信息</h5>
								<div class="ibox-tools">
									<a class="collapse-link"> <i class="fa fa-chevron-up"></i></a> 
									<a class="dropdown-toggle" data-toggle="dropdown" href=""> <i class="fa fa-wrench"></i></a>
									<ul class="dropdown-menu dropdown-user">
										<li><a href="javascript:;">暂无</a></li>
									</ul>
									<a class="close-link"> <i class="fa fa-times"></i></a>
								</div>
							</div>
							<div class="ibox-content">
								<form class="form-horizontal">
									<div class="form-group">
										<label class="col-lg-2 control-label">名称</label>
										<div class="col-lg-10">
											<input type="text" class="form-control" id="film_name" th:value="${movie_info.film_name}">
										</div>
									</div>
									<div class="form-group">
										<label class="col-lg-2 control-label">别名</label>
										<div class="col-lg-10">
											<input type="text" class="form-control" id="film_alias_name" th:value="${movie_info.film_alias_name}">
										</div>
									</div>
									<div class="form-group">
										<label class="col-lg-2 control-label">字幕</label>
										<div class="col-lg-10">
											<input type="text" class="form-control" id="film_subtitle" th:value="${movie_info.film_subtitle}">
										</div>
									</div>
									<div class="form-group">
										<label class="col-lg-2 control-label">语言</label>
										<div class="col-lg-10">
											<input type="text" class="form-control" id="film_language" th:value="${movie_info.film_language}">
										</div>
									</div>
									<div class="form-group">
										<label class="col-lg-2 control-label">类型</label>
										<div class="col-lg-10">
											<input type="text" placeholder="如动作／爱情" class="form-control" id="film_type" th:value="${movie_info.film_type}">
										</div>
									</div>
								</form>
							</div>
						</div>
					</div>
					<div class="col-lg-7">
						<div class="ibox float-e-margins">
							<div class="ibox-title">
								<h5>基本信息</h5>
								<div class="ibox-tools">
									<a class="collapse-link"> <i class="fa fa-chevron-up"></i></a> 
									<a class="dropdown-toggle" data-toggle="dropdown" href="form_basic.html#"> <i class="fa fa-wrench"></i></a>
									<ul class="dropdown-menu dropdown-user">
										<li><a href="javascript:;">暂无</a></li>
									</ul>
									<a class="close-link"> <i class="fa fa-times"></i></a>
								</div>
							</div>
							<div class="ibox-content">
								<div class="row">
									<div class="col-sm-8 b-r">
										<form class="form-horizontal">
											<div class="form-group">
												<label class="col-lg-2 control-label">电影规格</label>
												<div class="col-lg-10">
													<div class="input-group">
														<select class="form-control" id="film_dimen">
					                                    	<option>2D</option>
					                                    	<option>3D</option>
					                                    </select>
														<span class="input-group-addon">／</span>
														<select class="form-control" id="film_size">
					                                    	<option>普通</option>
					                                    	<option>IMAX</option>
					                                    	<option>中国巨幕</option>
					                                    </select>
													</div>
												</div>
											</div>
											<div class="form-group">
												<label class="col-lg-2 control-label">地区</label>
												<div class="col-lg-10">
													<input type="text" placeholder="如美国／中国" class="form-control" id="film_region" th:value="${movie_info.film_region}">
												</div>
											</div>
											<div class="form-group">
												<label class="col-lg-2 control-label">上映日期</label>
												<div class="col-lg-10">
													<input type="text" class="form-control" id="film_date" th:value="${movie_info.release_date}">
												</div>
											</div>
											<div class="form-group">
												<label class="col-lg-2 control-label">电影时长</label>
												<div class="col-lg-10">
													<input type="text" placeholder="如120" class="form-control" id="time_diff" th:value="${movie_info.time_diff}">
												</div>
											</div>
										</form>
									</div>
									<div class="col-sm-4">
										<form class="form-horizontal">
											<div class="form-group">
												<div class="lightBoxGallery">
													<a href="javascript:;" title="Image from Unsplash">
														<img id="pic_entry_img" th:src="${movie_info.pic_entry}" style="height:140px; width:95px">
													</a>
												</div>
											</div>
											<div class="form-group">
												<div class="col-lg-12">
													<input type="text" placeholder="海报" class="form-control pic_entry" id="pic_entry" th:value="${movie_info.pic_entry}">
												</div>
											</div>
										</form>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>

				<div class="row">
					<div class="col-lg-12">
						<div class="ibox float-e-margins">
							<div class="ibox-title">
								<h5>剧情梗概</h5>
								<button id="edit" class="btn btn-primary btn-xs m-l-sm edit_content" type="button">编辑</button>
								<button id="save" class="btn btn-primary  btn-xs save_content" type="button">保存</button>
							</div>
							<div class="ibox-content no-padding">
								<div class="click2edit wrapper p-md" th:utext="${movie_info.film_content}"></div>
							</div>
						</div>
					</div>
				</div>
			</div>
			<div th:replace="../common/foot"></div>
		</div>
	</div>
	
	   
	<!-- Mainly scripts -->
    <script th:src="@{{sp}/js/jquery-2.1.1.js(sp=${pub_bucket})}"></script>
    <script th:src="@{{sp}/js/bootstrap.min.js(sp=${pub_bucket})}"></script>
    <script th:src="@{{sp}/js/plugins/metisMenu/jquery.metisMenu.js(sp=${pub_bucket})}"></script>
    <script th:src="@{{sp}/js/plugins/slimscroll/jquery.slimscroll.min.js(sp=${pub_bucket})}"></script>

    <!-- Custom and plugin javascript -->
    <script th:src="@{{sp}/js/inspinia.js(sp=${pub_bucket})}"></script>
    <script th:src="@{{sp}/js/plugins/pace/pace.min.js(sp=${pub_bucket})}"></script>
    
    <script th:src="@{{sp}/third/layer3/layer.js(sp=${pub_bucket})}" type="text/javascript"></script>
    <script th:src="@{{sp}/js/plugins/select2/select2.full.min.js(sp=${pub_bucket})}" type="text/javascript"></script>
    
    <!-- SUMMERNOTE -->
    <script th:src="|${pub_bucket}/js/plugins/summernote/summernote.min.js|"></script>
    
    <script th:src="@{{sp}/jqui1114/jquery-ui.js(sp=${pub_bucket})}" type="text/javascript" charset="utf-8"></script>
    <script th:src="@{{sp}/jqui1114/jquery-ui-timepicker-addon.js(sp=${pub_bucket})}" type="text/javascript" charset="utf-8"></script>
    <script th:src="@{{sp}/jqui1114/jquery-ui-timepicker-zh-CN.js(sp=${pub_bucket})}" type="text/javascript" charset="utf-8"></script>
	
</body>

<script type="text/javascript">
$(function() {
	var rich_param = {
        height: 400,
        focus:true,
        onImageUpload: function onImageUpload(files, editor, $editable) {
        	console.log(editor);
        	console.log($editable);
            var formData = new FormData();
            formData.append("upfile", files[0]);
            formData.append("g_id", g);
            formData.append("img_type", "0600");
            $.ajax({
                url: '/scm/goods/aj/upload',
                type: "POST",
                data: formData,
                datatype:"json",
                contentType: false,
                processData: false,
                traditional: true,
                success: function (data) {
               		if(data.available) {
               			editor.insertImage($editable, 'http://pe1s.static.pdr365.com/' + data.data[0]['img_url']);
        			} else {
        				var code = data.messages[0];
        				var msg = '上传失败：' + code;
        				layer.msg(msg, {icon: 2});
        			}
                },
                error: function () {
               		layer.closeAll();
               		$this.ladda('stop');
               		swal({title: "Error", text: "操作失败", type: "error"});
                }
            });
		}
    };
	
	$(".pic_entry").on("change", function() {
		$("#pic_entry_img").attr('src', $(this).val());
	});

		
	var g = '[[${movie_info.id}]]';
	
	$(".edit_content").on("click", function() {
		$('.click2edit').summernote(rich_param);
	});
	
	$(".save_content").on("click", function() {
		var aHTML = $('.click2edit').code(); //save HTML If you need(aHTML: array).
		let film_name = $.trim($("#film_name").val());
		let film_alias_name = $.trim($("#film_alias_name").val());
		let film_subtitle = $.trim($("#film_subtitle").val());
		let film_language = $.trim($("#film_language").val());
		let film_type = $.trim($("#film_type").val());
		let film_dimen = $("#film_dimen").val();
		let film_size = $("#film_size").val();
		let film_region = $.trim($("#film_region").val());
		let film_date = $.trim($("#film_date").val());
		let time_diff = $.trim($("#time_diff").val());
		let pic_entry = $.trim($("#pic_entry").val());
		
		let params = {id:g,content:aHTML};
		params['film_name'] = film_name;
		params['film_alias_name'] = film_alias_name;
		params['film_subtitle'] = film_subtitle;
		params['film_language'] = film_language;
		params['film_dimen'] = film_dimen;
		params['film_type'] = film_type;
		params['film_size'] = film_size;
		params['film_region'] = film_region;
		params['film_date'] = film_date;
		params['time_diff'] = time_diff;
		params['pic_entry'] = pic_entry;
		
		$.post('/ticketingsys/movie/aj/save_content', params, function(data) {
			if(data.available) {
				layer.msg('信息保存成功');
				$('.click2edit').destroy();
			} else {
				var code = data.messages[0];
				var msg = "操作失败：" + code;
				if(data.messages.length>1) {
					msg = "操作失败：" + data.messages[1] + code;
				}
				layer.msg(msg, {shift: 6});
			}
		});
	});
});
</script>

</html>
